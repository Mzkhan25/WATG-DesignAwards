/*! designawards 2017-07-25 */
!function(){"use strict";var modules=["ngRoute","ngFileUpload","ui.tinymce"];angular.module("watgDesignAwards",modules)}(),function(){"use strict";function addCategoryController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,categoryService){function getAll(){$scope.busyGettingData=!0,categoryService.getAll().then(function(results){for(var i=0;i<results.length;i++)results[i].Image=$rootScope.arrayBufferToBase64(results[i].Image);$scope.records=results,$scope.busyGettingData=!1})}$scope.$on("$viewContentLoaded",function(){$(".dropdown-button").dropdown(),$(".button-collapse").sideNav()}),$scope.uploadPic=function(file){$scope.busyGettingData=!0,$scope.categoryImage&&$scope.categoryName&&categoryService.save(file,$scope.categoryName).then(function(results){$scope.categoryName="",$scope.categoryImage="",results?Materialize.toast("Category added successfully",4e3):Materialize.toast("Category not added",4e3),$scope.busyGettingData=!1})},$rootScope.categoryUploaded=function(){getAll()},$scope.modalClicked=function(shortCurrencyName,imageBlob){$scope.shortCurrencyName=shortCurrencyName,$scope.imageBlob=imageBlob},$scope.delete=function(id){$scope.busyGettingData=!0,categoryService.delete(id).then(function(result){results?Materialize.toast("Category removed successfully",4e3):Materialize.toast("Error occured",4e3),getAll()})},$rootScope.validateAdmin(),getAll()}angular.module("watgDesignAwards").controller("addCategoryController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","categoryService",addCategoryController])}(),function(){"use strict";function addProjectController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,$sce,categoryService,projectService){function getAllCategories(){$scope.busyGettingData=!0,categoryService.getAll().then(function(results){$scope.categories=results;for(var i=0;i<results.length;i++)$scope.categoryList.push(angular.copy(results[i].CategoryName));$scope.busyGettingData=!1})}$scope.$on("$viewContentLoaded",function(){$(".dropdown-button").dropdown(),$(".button-collapse").sideNav()}),$scope.tinymceModel="Initial content",$scope.getContent=function(){console.log("Editor content",$scope.tinymceModel)},$scope.setContent=function(){$scope.tinymceModel="Time "+new Date},$scope.tinymceOptions={plugins:"link image code paste media",toolbar:"undo redo  bold italic  alignleft aligncenter alignright code image paste",paste_data_images:!0},$scope.busyGettingData=!0,$scope.categories=[],$scope.categoryList=[],$rootScope.projectUploaded=function(){getAllCategories()},$scope.uploadPic=function(){console.log($scope.Project),$scope.busyGettingData=!0;projectService.save($scope.Project,$scope.DisplayImage,$scope.Pdf).then(function(results){$scope.Project.Title="",$scope.Project.Office="",$scope.Project.CategoryId="",$scope.Project.Description="",$scope.DisplayImage="",$scope.Pdf="",results?(Materialize.toast("Project added successfully",4e3),$scope.busyGettingData=!1):(Materialize.toast("Project not added",4e3),$scope.busyGettingData=!1)})},$rootScope.validateAdmin(),getAllCategories()}angular.module("watgDesignAwards").controller("addProjectController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","$sce","categoryService","projectService",addProjectController])}(),function(){"use strict";function addUserController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,userService){$scope.busyGettingData=!1,$scope.$on("$viewContentLoaded",function(){$(".dropdown-button").dropdown(),$(".button-collapse").sideNav()}),$scope.roles=[{Id:0,Name:"Admin"},{Id:1,Name:"User"}],$scope.saveUser=function(){$scope.busyGettingData=!0,userService.save($scope.User).then(function(result){$scope.User.FirstName="",$scope.User.LastName="",$scope.User.Email="",$scope.User.Password="",$scope.User.Role="",result?Materialize.toast("User added successfully",4e3):Materialize.toast("User not added",4e3),$scope.busyGettingData=!1})},$rootScope.validateAdmin()}angular.module("watgDesignAwards").controller("addUserController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","userService",addUserController])}(),function(){"use strict";function categoryController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,categoryService){function getAll(){$scope.busyGettingData=!0,categoryService.getAll().then(function(results){for(var i=0;i<results.length;i++)results[i].Image=$rootScope.arrayBufferToBase64(results[i].Image);$scope.records=results,$rootScope.categories=results,$scope.busyGettingData=!1})}$scope.categoryList=[],$scope.busyGettingData=!0,$rootScope.arrayBufferToBase64=function(buffer){for(var binary="",bytes=new Uint8Array(buffer),len=bytes.byteLength,i=0;i<len;i++)binary+=String.fromCharCode(bytes[i]);return window.btoa(binary)},$scope.loadProjects=function(id){$location.path("/projects/"+id)},$rootScope.validateUser(),getAll()}angular.module("watgDesignAwards").controller("categoryController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","categoryService",categoryController])}(),function(){"use strict";function loginController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,userService){$scope.userPin="",$scope.invalidUserMsg="Please email helpdesk@watg.com in case you are unable to login to the design awards",$scope.invalidPINFlag=!1,$scope.busyGettingData=!1,$scope.loginEnterKey=function(keyEvent){13===keyEvent.which&&$scope.login()},$scope.login=function(){$scope.busyGettingData=!0,userService.login($scope.userPin).then(function(result){localStorage.setItem("userObj",JSON.stringify(result)),1===result.Role?($scope.busyGettingData=!1,localStorage.setItem("loginTimeStamp",new Date),$location.path("/category")):0===result.Role?($scope.busyGettingData=!1,localStorage.setItem("loginTimeStamp",new Date),$location.path("/results")):($scope.invalidPINFlag=!0,$scope.busyGettingData=!1)})}}angular.module("watgDesignAwards").controller("loginController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","userService",loginController])}(),function(){"use strict";function projectDetailController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,$sce,projectService,categoryService){$scope.busyGettingData=!0,$scope.projectId=$routeParams.projectId,$scope.categoryName="",$scope.$on("$viewContentLoaded",function(){$(".dropdown-button").dropdown(),$(".button-collapse").sideNav()});var getProjectById=function(){projectService.getById($scope.projectId).then(function(result){categoryService.getOne(result[0].CategoryId).then(function(category){$scope.categoryName=category[0].CategoryName}),result[0].DisplayImage=$rootScope.arrayBufferToBase64(result[0].DisplayImage),result[0].Description=$sce.trustAsHtml(result[0].Description),$scope.project=result[0],$scope.busyGettingData=!1})};$scope.getProject=function(){$window.open($scope.project.PdfPath)},$rootScope.validateUser(),getProjectById()}angular.module("watgDesignAwards").controller("projectDetailController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","$sce","projectService","categoryService",projectDetailController])}(),function(){"use strict";function projectsController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,$sce,projectService,resultService,categoryService){$scope.categoryId=$routeParams.categoryId,$scope.projectList=[],$scope.voted="",$scope.voteStatus="",$scope.voteResponse=!1,$scope.disbleVotBtn=!1,$scope.busyGettingData=!0,$scope.categoryName="",$scope.$on("$viewContentLoaded",function(){$(".dropdown-button").dropdown(),$(".button-collapse").sideNav(),$(".parallax").parallax()});var getProjectByCategory=function(){projectService.getByCategory($scope.categoryId).then(function(results){for(var i=0;i<results.length;i++)results[i].DisplayImage=$rootScope.arrayBufferToBase64(results[i].DisplayImage),results[i].Description=$sce.trustAsHtml(results[i].Description);$scope.projectList=results,categoryService.getOne($scope.categoryId).then(function(category){$scope.categoryName=category[0].CategoryName}),$scope.busyGettingData=!1})},voteAlreadyCasted=function(){resultService.checkUserVote($scope.categoryId,JSON.parse(localStorage.getItem("userObj")).Id).then(function(result){$scope.hasAlreadyVoted=result,getProjectByCategory()})};$scope.loadProjects=function(categoryId){$location.path("/projects/"+categoryId)},$scope.saveVote=function(projectId,categoryId){var voteRequest={UserId:JSON.parse(localStorage.getItem("userObj")).Id,ProjectId:projectId,CategoryId:categoryId};$scope.disbleVotBtn=!0,resultService.save(voteRequest).then(function(response){$scope.voteResponse=!0})},$scope.selectedProject=function(id){$location.path("/projectDetail/"+id)},$rootScope.validateUser(),voteAlreadyCasted()}angular.module("watgDesignAwards").controller("projectsController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","$sce","projectService","resultService","categoryService",projectsController])}(),function(){"use strict";function resultController($scope,$rootScope,$routeParams,$location,$filter,$timeout,$window,resultService){$scope.$on("$viewContentLoaded",function(){$(".dropdown-button").dropdown(),$(".button-collapse").sideNav()});var getResults=function(){resultService.getAll().then(function(result){$scope.resultList=result,$scope.busyGettingData=!1})};$scope.busyGettingData=!0,$rootScope.validateAdmin(),getResults()}angular.module("watgDesignAwards").controller("resultController",["$scope","$rootScope","$routeParams","$location","$filter","$timeout","$window","resultService",resultController])}(),function(){function appConfig($httpProvider,$routeProvider,$locationProvider,$provide){$provide.decorator("$exceptionHandler",function($delegate){return function(exception,cause){$delegate(exception,cause),alert("Error occurred! Please contact admin.")}}),$httpProvider.defaults.useXDomain=!0,$locationProvider.hashPrefix(""),delete $httpProvider.defaults.headers.common["X-Requested-With"],$routeProvider.when("/category",{templateUrl:"app/views/category.html",controller:"categoryController"}).when("/login",{templateUrl:"app/views/login.html",controller:"loginController"}).when("/projects/:categoryId?",{templateUrl:"app/views/projects.html",controller:"projectsController"}).when("/addCategory",{templateUrl:"app/views/addCategory.html",controller:"addCategoryController"}).when("/addUser",{templateUrl:"app/views/addUser.html",controller:"addUserController"}).when("/addProject",{templateUrl:"app/views/addProject.html",controller:"addProjectController"}).when("/projectDetail/:projectId?",{templateUrl:"app/views/projectDetail.html",controller:"projectDetailController"}).when("/results",{templateUrl:"app/Views/results.html",controller:"resultController"}).otherwise({redirectTo:"/login"})}function appRun($rootScope,$location,$interval,$filter,appService){$rootScope.pageTitle="WATG| Design Awards",$rootScope.form={},$rootScope.userApplicationRoles=[],$rootScope.currentRoute="/Login",$rootScope.adminRoleList=["/results","/addProject","/addUser","/addCategory"],$rootScope.user=localStorage.getItem("userObj"),$rootScope.arrayBufferToBase64=function(buffer){for(var binary="",bytes=new Uint8Array(buffer),len=bytes.byteLength,i=0;i<len;i++)binary+=String.fromCharCode(bytes[i]);return window.btoa(binary)},$rootScope.validateAdmin=function(){var stateUrl=$location.url();if(localStorage.getItem("userObj")){var loggedInTimeStamp=localStorage.getItem("loginTimeStamp"),currentTimeStamp=new Date,timeDiff=$rootScope.calculateDiffInMins(loggedInTimeStamp,currentTimeStamp);0===JSON.parse(localStorage.getItem("userObj")).Role&&timeDiff<parseInt(localStorage.getItem("sessionTime"))?$location.path(stateUrl):$location.path("/login")}else $location.path("/login")},$rootScope.validateUser=function(){var stateUrl=$location.url();if(localStorage.getItem("userObj")){var loggedInTimeStamp=localStorage.getItem("loginTimeStamp"),currentTimeStamp=new Date,timeDiff=$rootScope.calculateDiffInMins(loggedInTimeStamp,currentTimeStamp);1===JSON.parse(localStorage.getItem("userObj")).Role&&timeDiff<parseInt(localStorage.getItem("sessionTime"))?$location.path(stateUrl):$location.path("/login")}else $location.path("/login")},$rootScope.logOut=function(){var previousSessionTime=localStorage.getItem("sessionTime");localStorage.clear(),localStorage.setItem("sessionTime",previousSessionTime),$location.path("/login")},$rootScope.makeFolders=function(){appService.makeNecessarryFolders().then(function(response){console.log(response+"Folder make result")})},$rootScope.makeFolders(),$rootScope.getTime=function(){appService.getSessionTime().then(function(response){localStorage.setItem("sessionTime",response)})},$rootScope.getTime(),$rootScope.calculateDiffInMins=function(loggedInDate,currentDate){return new Date(currentDate-new Date(loggedInDate)).getMinutes()},$rootScope.navigateHome=function(){0===JSON.parse(localStorage.getItem("userObj")).Role?$location.path("/results"):1===JSON.parse(localStorage.getItem("userObj")).Role&&$location.path("/category")}}var app=angular.module("watgDesignAwards");app.config(["$httpProvider","$routeProvider","$locationProvider","$provide",appConfig]),app.run(["$rootScope","$location","$interval","$filter","appService",appRun])}(),angular.module("watgDesignAwardsConst",[]).constant("CONST_WATGXRESTAPIURL","http://localhost:8080/api").constant("CONST_RESOURCEURL","http://localhost:8081").constant("CONST_LOGSENABLED",!0).constant("CONST_W1_STAFF_PROFILE_URL","http://itstage.watg.com/watg1/#teamMemberDetails/"),function(){"use strict";angular.module("watgDesignAwards").filter("cut",["$filter",function($filter){return function(value,wordwise,max,tail){if(!value)return"";if(!(max=parseInt(max,10)))return value;if(value.length<=max)return value;if(value=value.substr(0,max),wordwise){var lastspace=value.lastIndexOf(" ");-1!==lastspace&&("."!==value.charAt(lastspace-1)&&","!==value.charAt(lastspace-1)||(lastspace-=1),value=value.substr(0,lastspace))}return value+(tail||" …")}}])}(),function(){"use strict";function appService($http,$rootScope){return{makeNecessarryFolders:function(){return $http({method:"GET",url:"Util/MakeNecessarryFolders"}).then(function(response){return response.data})},getSessionTime:function(){return $http({method:"GET",url:"Util/GetUserSessionTime"}).then(function(response){return response.data})}}}angular.module("watgDesignAwards").factory("appService",["$http","$rootScope",appService])}(),function(){"use strict";function categoryService($http,Upload,$rootScope){return{getAll:function(){return $http({method:"GET",url:"Category/GetAll"}).then(function(response){return response.data})},getOne:function(id){return $http({method:"GET",url:"Category/GetOne?id="+id}).then(function(response){return response.data})},save:function(file,name){return Upload.upload({url:"Category/Save",data:{name:name,file:file}}).then(function(resp){return $rootScope.categoryUploaded(),resp.data})},delete:function(id){return $http({method:"POST",data:{id:id},url:"Category/Delete?id="+id}).then(function(response){return response.data})}}}angular.module("watgDesignAwards").factory("categoryService",["$http","Upload","$rootScope",categoryService])}(),function(){"use strict";function projectService($http,Upload,$rootScope){return{getAll:function(){return $http({method:"GET",url:"Project/GetAll"}).then(function(response){return response.data})},getByCategory:function(id){return $http({method:"GET",url:"Project/GetByCategory?id="+id}).then(function(response){return response.data})},getById:function(id){return $http({method:"GET",url:"Project/GetById?id="+id}).then(function(response){return response.data})},save:function(project,image,document){return Upload.upload({url:"Project/Save",data:{project:project,image:image,document:document}}).then(function(resp){return resp.data})}}}angular.module("watgDesignAwards").factory("projectService",["$http","Upload","$rootScope",projectService])}(),function(){"use strict";function resultService($http,$rootScope){return{getAll:function(){return $http({method:"GET",url:"Result/GetAll"}).then(function(response){return response.data})},getOne:function(id){return $http({method:"GET",url:"Result/GetOne?id="+id}).then(function(response){return response.data})},checkUserVote:function(categoryId,userId){return $http({method:"GET",url:"Result/CheckUserVote?categoryId="+categoryId+"&userId="+userId}).then(function(response){return response.data})},save:function(result){return $http({method:"POST",data:{result:result},url:"Result/Save/"}).then(function(response){return response.data})}}}angular.module("watgDesignAwards").factory("resultService",["$http","$rootScope",resultService])}(),function(){"use strict";function userService($http,$rootScope){return{getAll:function(){return $http({method:"GET",url:"User/GetAll"}).then(function(response){return response.data})},login:function(password){return $http({method:"GET",url:"User/Login?password="+password}).then(function(response){return response.data})},save:function(user){return $http({method:"POST",data:{user:user},url:"User/Save/"}).then(function(response){return response.data})},delete:function(id){return $http({method:"POST",data:{id:id},url:"User/Delete?id="+id}).then(function(response){return response.data})}}}angular.module("watgDesignAwards").factory("userService",["$http","$rootScope",userService])}();